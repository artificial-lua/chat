<!DOCTYPE html>
<html lang="ko">
<head> 
    <meta charset="UTF-8">
    <title>Form</title>
</head>
<body>
    <header>
        <h1>웹소켓 테스트</h1>
    </header>

    <!--create TextArea to recive messages log-->
    <textarea id="log" rows="10" cols="50" readonly style="resize:none"></textarea>
    
    <!--create input message box-->
    <form>
        <!--create user id box-->
        <input type="text" id="user_id" name="user_id" placeholder="아이디를 입력하세요.">
        <input type="text" name="message" placeholder="메시지를 입력하세요." id="message">
        <input type="button" id="btn_send" value="전송">
        <button id="btn_close">close</button>
    <!-- create two buttons -->
</body>
</html>
<script>
    /*
    never use jquery
    */
    
    // create websocket client by 30000 port
    const ws = new WebSocket('ws://localhost:30000');
    // when connection is opened
    ws.onopen = function() {
        console.log('connection is opened');
    };
    // when message is received
    ws.onmessage = function(e) {
        // get message from server and unpakcage json
        const data = JSON.parse(e.data);
        // get log textarea
        const log = document.getElementById('log');
        // append message to log textarea
        log.value += data.user_id + ' : ' + data.message + '\n';
    };
    // when connection is closed
    ws.onclose = function() {
        console.log('connection is closed');
    };
    // when error occurs
    ws.onerror = function(e) {
        console.log('error occurs');
    };
    // when send button is clicked
    document.getElementById('btn_send').onclick = function() {
        // if message is not empty
        if (document.getElementById('message').value != '') {
            // send id and message and pakcage them as json to server by websocket
            ws.send(JSON.stringify({
                user_id: document.getElementById('user_id').value,
                message: document.getElementById('message').value
            }));
            // clear message box
            document.getElementById('message').value = '';
        }
    };
    // when close button is clicked
    document.getElementById('btn_close').onclick = function() {
        // close connection
        ws.close();
    };
</script>